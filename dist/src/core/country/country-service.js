"use strict";
/**
 * Copyright (c) 2020 Codev Technologies (Pty) Ltd. All rights reserved.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.CountryService = void 0;
const _ = require("lodash");
const countries = require("../../../countries.json");
const continents = require("../../../continents.json");
const country_code_type_enum_1 = require("./country-code-type.enum");
const country_1 = require("./country");
class CountryService {
    constructor() {
    }
    mapCountry(country) {
        if (!country) {
            return null;
        }
        return new country_1.Country(country.name, country.nationality, country.continent, country.hasSubdivision, country.code, country.alternateNames, country.isState);
    }
    getCountries() {
        return _.map(countries, (country) => {
            return this.mapCountry(country);
        });
    }
    // Only Alpha2OrSubdivision type
    getCountryCodes() {
        return _.map(countries, (country) => {
            return country.code.alpha2 ? country.code.alpha2 : country.code.subdivision;
        });
    }
    getContinentCountryCodes(code) {
        let countryCodes = _.map(countries, (country) => {
            return country.continent === code ? (country.code.alpha2 ? country.code.alpha2 : country.code.subdivision) : null;
        });
        return _.reject(countryCodes, _.isNull);
    }
    getCountryCodesByContinent() {
        let continentMap = {};
        _.each(continents, (continent) => {
            continentMap[continent.code] = this.getContinentCountryCodes(continent.code);
        });
        return continentMap;
    }
    getContinents() {
        return continents;
    }
    countryCodeTypeToAttribute(countryCodeType) {
        let countryCodeTypeAttribute;
        switch (countryCodeType) {
            case country_code_type_enum_1.CountryCodeType.Numeric:
                countryCodeTypeAttribute = "numeric";
                break;
            case country_code_type_enum_1.CountryCodeType.Alpha2:
                countryCodeTypeAttribute = "alpha2";
                break;
            case country_code_type_enum_1.CountryCodeType.Alpha3:
                countryCodeTypeAttribute = "alpha3";
                break;
            case country_code_type_enum_1.CountryCodeType.Subdivision:
                countryCodeTypeAttribute = "subdivision";
                break;
            case country_code_type_enum_1.CountryCodeType.Alpha2OrSubdivision:
                countryCodeTypeAttribute = "alpha2,subdivision";
                break;
            default:
                throw new Error(`Invalid country code type: ${countryCodeType}`);
        }
        return countryCodeTypeAttribute;
    }
    getCountry(countryCode, countryCodeType) {
        let countryCodeTypeAttribute = this.countryCodeTypeToAttribute(countryCodeType);
        if (countryCodeTypeAttribute === "alpha2,subdivision") {
            return this.mapCountry(_.find(countries, function (country) {
                return country.code.alpha2 === countryCode || country.code.subdivision === countryCode;
            }));
        }
        else {
            return this.mapCountry(_.find(countries, function (country) {
                return country.code[countryCodeTypeAttribute] === countryCode;
            }));
        }
    }
    getCountryByName(countryName) {
        const formattedCountryName = countryName.toLowerCase();
        return this.mapCountry(_.find(countries, function (country) {
            const alternateNameMatch = _.some(country.alternateNames, function (alternateName) {
                return alternateName.toLowerCase() === formattedCountryName;
            });
            return country.name.toLowerCase() === formattedCountryName || alternateNameMatch;
        }));
    }
    getCountryCodeByName(countryName) {
        let country = countries.find(c => c.name.toLowerCase() === countryName.toLowerCase());
        if (country) {
            if (country.code.alpha2) {
                return country.code.alpha2;
            }
            else if (country.code.subdivision) {
                return country.code.subdivision;
            }
            else {
                return "";
            }
        }
    }
}
exports.CountryService = CountryService;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY291bnRyeS1zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2NvcmUvY291bnRyeS9jb3VudHJ5LXNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBOztHQUVHOzs7QUFFSCw0QkFBNEI7QUFHNUIscURBQXFEO0FBQ3JELHVEQUF1RDtBQUN2RCxxRUFBMkQ7QUFDM0QsdUNBQW9DO0FBR3BDLE1BQWEsY0FBYztJQUV2QjtJQUNBLENBQUM7SUFFRCxVQUFVLENBQUMsT0FBWTtRQUVuQixJQUFJLENBQUMsT0FBTyxFQUFFLENBQUM7WUFDWCxPQUFPLElBQUksQ0FBQztRQUNoQixDQUFDO1FBRUQsT0FBTyxJQUFJLGlCQUFPLENBQ2QsT0FBTyxDQUFDLElBQUksRUFDWixPQUFPLENBQUMsV0FBVyxFQUNuQixPQUFPLENBQUMsU0FBUyxFQUNqQixPQUFPLENBQUMsY0FBYyxFQUN0QixPQUFPLENBQUMsSUFBSSxFQUNaLE9BQU8sQ0FBQyxjQUFjLEVBQ3RCLE9BQU8sQ0FBQyxPQUFPLENBQ2xCLENBQUM7SUFDTixDQUFDO0lBRUQsWUFBWTtRQUNSLE9BQU8sQ0FBQyxDQUFDLEdBQUcsQ0FBQyxTQUFTLEVBQUUsQ0FBQyxPQUFPLEVBQUUsRUFBRTtZQUNoQyxPQUFPLElBQUksQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDcEMsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDO0lBRUQsZ0NBQWdDO0lBQ2hDLGVBQWU7UUFDWCxPQUFPLENBQUMsQ0FBQyxHQUFHLENBQUMsU0FBUyxFQUFFLENBQUMsT0FBTyxFQUFFLEVBQUU7WUFDaEMsT0FBTyxPQUFPLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDO1FBQ2hGLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FB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Q0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLFVBQVUsT0FBTztZQUN0RCxNQUFNLGtCQUFrQixHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLGNBQWMsRUFBRSxVQUFTLGFBQWE7Z0JBQzVFLE9BQU8sYUFBYSxDQUFDLFdBQVcsRUFBRSxLQUFLLG9CQUFvQixDQUFDO1lBQ2hFLENBQUMsQ0FBQyxDQUFDO1lBRUgsT0FBTyxPQUFPLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRSxLQUFLLG9CQUFvQixJQUFJLGtCQUFrQixDQUFDO1FBQ3JGLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDUixDQUFDO0lBRUQsb0JBQW9CLENBQUMsV0FBbUI7UUFDckMsSUFBSSxPQUFPLEdBQUcsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsV0FBVyxFQUFFLEtBQUssV0FBVyxDQUFDLFdBQVcsRUFBRSxDQUFDLENBQUM7UUFDdEYsSUFBRyxPQUFPLEVBQUUsQ0FBQztZQUNULElBQUcsT0FBTyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQztnQkFDckIsT0FBTyxPQUFPLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQztZQUMvQixDQUFDO2lCQUFNLElBQUcsT0FBTyxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztnQkFDakMsT0FBTyxPQUFPLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQztZQUNwQyxDQUFDO2lCQUFNLENBQUM7Z0JBQ0osT0FBTyxFQUFFLENBQUM7WUFDZCxDQUFDO1FBQ0wsQ0FBQztJQUNKLENBQUM7Q0FDSjtBQXZIRCx3Q0F1SEMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQ29weXJpZ2h0IChjKSAyMDIwIENvZGV2IFRlY2hub2xvZ2llcyAoUHR5KSBMdGQuIEFsbCByaWdodHMgcmVzZXJ2ZWQuXHJcbiAqL1xyXG5cclxuaW1wb3J0ICogYXMgXyBmcm9tIFwibG9kYXNoXCI7XHJcbmltcG9ydCBjb25maWcgZnJvbSAnLi4vLi4vY29uZmlnJztcclxuaW1wb3J0IHsgTG9nZ2VyIH0gZnJvbSBcIi4uL2xvZ2dpbmdcIjtcclxuaW1wb3J0ICogYXMgY291bnRyaWVzIGZyb20gXCIuLi8uLi8uLi9jb3VudHJpZXMuanNvblwiO1xyXG5pbXBvcnQgKiBhcyBjb250aW5lbnRzIGZyb20gXCIuLi8uLi8uLi9jb250aW5lbnRzLmpzb25cIjtcclxuaW1wb3J0IHsgQ291bnRyeUNvZGVUeXBlIH0gZnJvbSBcIi4vY291bnRyeS1jb2RlLXR5cGUuZW51bVwiO1xyXG5pbXBvcnQgeyBDb3VudHJ5IH0gZnJvbSBcIi4vY291bnRyeVwiO1xyXG5pbXBvcnQgeyBDb250aW5lbnQgfSBmcm9tIFwiLi9jb250aW5lbnRcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBDb3VudHJ5U2VydmljZSB7XHJcblxyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICB9XHJcblxyXG4gICAgbWFwQ291bnRyeShjb3VudHJ5OiBhbnkpIHtcclxuXHJcbiAgICAgICAgaWYgKCFjb3VudHJ5KSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIG5ldyBDb3VudHJ5KFxyXG4gICAgICAgICAgICBjb3VudHJ5Lm5hbWUsXHJcbiAgICAgICAgICAgIGNvdW50cnkubmF0aW9uYWxpdHksXHJcbiAgICAgICAgICAgIGNvdW50cnkuY29udGluZW50LFxyXG4gICAgICAgICAgICBjb3VudHJ5Lmhhc1N1YmRpdmlzaW9uLFxyXG4gICAgICAgICAgICBjb3VudHJ5LmNvZGUsXHJcbiAgICAgICAgICAgIGNvdW50cnkuYWx0ZXJuYXRlTmFtZXMsXHJcbiAgICAgICAgICAgIGNvdW50cnkuaXNTdGF0ZVxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0Q291bnRyaWVzKCk6IENvdW50cnlbXSB7XHJcbiAgICAgICAgcmV0dXJuIF8ubWFwKGNvdW50cmllcywgKGNvdW50cnkpID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMubWFwQ291bnRyeShjb3VudHJ5KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBPbmx5IEFscGhhMk9yU3ViZGl2aXNpb24gdHlwZVxyXG4gICAgZ2V0Q291bnRyeUNvZGVzKCk6IHN0cmluZ1tdIHtcclxuICAgICAgICByZXR1cm4gXy5tYXAoY291bnRyaWVzLCAoY291bnRyeSkgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gY291bnRyeS5jb2RlLmFscGhhMiA/IGNvdW50cnkuY29kZS5hbHBoYTIgOiBjb3VudHJ5LmNvZGUuc3ViZGl2aXNpb247XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0Q29udGluZW50Q291bnRyeUNvZGVzKGNvZGU6IHN0cmluZyk6IHN0cmluZ1tdIHtcclxuICAgICAgICBsZXQgY291bnRyeUNvZGVzID0gXy5tYXAoY291bnRyaWVzLCAoY291bnRyeSkgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gY291bnRyeS5jb250aW5lbnQgPT09IGNvZGUgPyAoY291bnRyeS5jb2RlLmFscGhhMiA/IGNvdW50cnkuY29kZS5hbHBoYTIgOiBjb3VudHJ5LmNvZGUuc3ViZGl2aXNpb24pIDogbnVsbDtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIF8ucmVqZWN0KGNvdW50cnlDb2RlcywgXy5pc051bGwpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldENvdW50cnlDb2Rlc0J5Q29udGluZW50KCkge1xyXG4gICAgICAgIGxldCBjb250aW5lbnRNYXAgOiBhbnkgPSB7fTtcclxuXHJcbiAgICAgICAgXy5lYWNoKGNvbnRpbmVudHMsIChjb250aW5lbnQpID0+IHtcclxuICAgICAgICAgICAgY29udGluZW50TWFwW2NvbnRpbmVudC5jb2RlXSA9IHRoaXMuZ2V0Q29udGluZW50Q291bnRyeUNvZGVzKGNvbnRpbmVudC5jb2RlKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gY29udGluZW50TWFwO1xyXG4gICAgfVxyXG5cclxuICAgIGdldENvbnRpbmVudHMoKTogQ29udGluZW50W10ge1xyXG4gICAgICAgIHJldHVybiBjb250aW5lbnRzO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgY291bnRyeUNvZGVUeXBlVG9BdHRyaWJ1dGUoY291bnRyeUNvZGVUeXBlOiBDb3VudHJ5Q29kZVR5cGUpIHtcclxuICAgICAgICBsZXQgY291bnRyeUNvZGVUeXBlQXR0cmlidXRlOiBhbnk7XHJcblxyXG4gICAgICAgIHN3aXRjaCAoY291bnRyeUNvZGVUeXBlKSB7XHJcbiAgICAgICAgICAgIGNhc2UgQ291bnRyeUNvZGVUeXBlLk51bWVyaWM6XHJcbiAgICAgICAgICAgICAgICBjb3VudHJ5Q29kZVR5cGVBdHRyaWJ1dGUgPSBcIm51bWVyaWNcIjtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIENvdW50cnlDb2RlVHlwZS5BbHBoYTI6XHJcbiAgICAgICAgICAgICAgICBjb3VudHJ5Q29kZVR5cGVBdHRyaWJ1dGUgPSBcImFscGhhMlwiO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgQ291bnRyeUNvZGVUeXBlLkFscGhhMzpcclxuICAgICAgICAgICAgICAgIGNvdW50cnlDb2RlVHlwZUF0dHJpYnV0ZSA9IFwiYWxwaGEzXCI7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBDb3VudHJ5Q29kZVR5cGUuU3ViZGl2aXNpb246XHJcbiAgICAgICAgICAgICAgICBjb3VudHJ5Q29kZVR5cGVBdHRyaWJ1dGUgPSBcInN1YmRpdmlzaW9uXCI7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBDb3VudHJ5Q29kZVR5cGUuQWxwaGEyT3JTdWJkaXZpc2lvbjpcclxuICAgICAgICAgICAgICAgIGNvdW50cnlDb2RlVHlwZUF0dHJpYnV0ZSA9IFwiYWxwaGEyLHN1YmRpdmlzaW9uXCI7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgSW52YWxpZCBjb3VudHJ5IGNvZGUgdHlwZTogJHtjb3VudHJ5Q29kZVR5cGV9YCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBjb3VudHJ5Q29kZVR5cGVBdHRyaWJ1dGU7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0Q291bnRyeShjb3VudHJ5Q29kZTogc3RyaW5nLCBjb3VudHJ5Q29kZVR5cGU6IENvdW50cnlDb2RlVHlwZSk6IENvdW50cnkge1xyXG4gICAgICAgIGxldCBjb3VudHJ5Q29kZVR5cGVBdHRyaWJ1dGU6IGFueSA9IHRoaXMuY291bnRyeUNvZGVUeXBlVG9BdHRyaWJ1dGUoY291bnRyeUNvZGVUeXBlKTtcclxuXHJcbiAgICAgICAgaWYgKGNvdW50cnlDb2RlVHlwZUF0dHJpYnV0ZSA9PT0gXCJhbHBoYTIsc3ViZGl2aXNpb25cIikge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5tYXBDb3VudHJ5KF8uZmluZChjb3VudHJpZXMsIGZ1bmN0aW9uIChjb3VudHJ5KSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gY291bnRyeS5jb2RlLmFscGhhMiA9PT0gY291bnRyeUNvZGUgfHwgY291bnRyeS5jb2RlLnN1YmRpdmlzaW9uID09PSBjb3VudHJ5Q29kZTtcclxuICAgICAgICAgICAgfSkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMubWFwQ291bnRyeShfLmZpbmQoY291bnRyaWVzLCBmdW5jdGlvbiAoY291bnRyeSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIChjb3VudHJ5LmNvZGUgYXMgYW55KVtjb3VudHJ5Q29kZVR5cGVBdHRyaWJ1dGVdID09PSBjb3VudHJ5Q29kZTtcclxuICAgICAgICAgICAgfSkpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBnZXRDb3VudHJ5QnlOYW1lKGNvdW50cnlOYW1lOiBzdHJpbmcpOiBDb3VudHJ5IHtcclxuICAgICAgICBjb25zdCBmb3JtYXR0ZWRDb3VudHJ5TmFtZSA9IGNvdW50cnlOYW1lLnRvTG93ZXJDYXNlKCk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMubWFwQ291bnRyeShfLmZpbmQoY291bnRyaWVzLCBmdW5jdGlvbiAoY291bnRyeSkge1xyXG4gICAgICAgICAgICBjb25zdCBhbHRlcm5hdGVOYW1lTWF0Y2ggPSBfLnNvbWUoY291bnRyeS5hbHRlcm5hdGVOYW1lcywgZnVuY3Rpb24oYWx0ZXJuYXRlTmFtZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGFsdGVybmF0ZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gZm9ybWF0dGVkQ291bnRyeU5hbWU7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGNvdW50cnkubmFtZS50b0xvd2VyQ2FzZSgpID09PSBmb3JtYXR0ZWRDb3VudHJ5TmFtZSB8fCBhbHRlcm5hdGVOYW1lTWF0Y2g7XHJcbiAgICAgICAgfSkpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldENvdW50cnlDb2RlQnlOYW1lKGNvdW50cnlOYW1lOiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gICAgICAgbGV0IGNvdW50cnkgPSBjb3VudHJpZXMuZmluZChjID0+IGMubmFtZS50b0xvd2VyQ2FzZSgpID09PSBjb3VudHJ5TmFtZS50b0xvd2VyQ2FzZSgpKTtcclxuICAgICAgIGlmKGNvdW50cnkpIHtcclxuICAgICAgICAgICBpZihjb3VudHJ5LmNvZGUuYWxwaGEyKSB7XHJcbiAgICAgICAgICAgICAgIHJldHVybiBjb3VudHJ5LmNvZGUuYWxwaGEyO1xyXG4gICAgICAgICAgIH0gZWxzZSBpZihjb3VudHJ5LmNvZGUuc3ViZGl2aXNpb24pIHtcclxuICAgICAgICAgICAgICAgcmV0dXJuIGNvdW50cnkuY29kZS5zdWJkaXZpc2lvbjtcclxuICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICByZXR1cm4gXCJcIjtcclxuICAgICAgICAgICB9XHJcbiAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIl19